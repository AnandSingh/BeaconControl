<div class="row form-container">
  <div class="col-md-6 first-column">
    <div class="control-group">
      <div class="controls">
        <%= f.input :name,
                    input_html: {
                        data: {
                            required: true
                        }
                    }
        %>
      </div>
    </div>

    <% unless @beacon.imported? %>
      <div class="control-group">
        <div class="controls">
          <%= f.input :vendor,
                      as: :select,
                      collection: Beacon::VENDORS,
                      include_blank: false,
                      input_html: {
                          class: %W[selectpicker event-publisher],
                          data: {
                              live_search: true
                          }
                      }
          %>
        </div>
      </div>
      <div class="control-group event-subscriber" data-publisher="#beacon_vendor" data-match="Kontakt" data-action="show">
        <div class="controls">
          <%= link_to t('beacons.form.active_kontakt_io'),
                      activate_extensions_marketplace_path('Kontakt.io'),
                      method: :put
          %>
        </div>
      </div>
    <% end %>

    <div class="control-group event-subscriber" data-publisher="#beacon_vendor" data-match="Kontakt" data-action="show">
      <div class="controls">
        <%= f.input :vendor_uid,
                    label: 'Device ID',
                    input_html: {
                        data: {
                            :'validate-if' => '#beacon_vendor=Kontakt',
                            required: true
                        }
                    }
        %>
      </div>
    </div>

    <%= render 'beacons/form/state',
               f: f,
               beacon: beacon
    %>

    <%- if master_beacon(@beacon) %>
      <div id="beacon-cloud" class="with-huge-space control-group">
        <div class="controls">
          <div class="form-group">
            <label class="control-label">
              <%= t('beacons.form.synchronized_by') %>
            </label>
            <%= link_to edit_beacon_path(master_beacon(@beacon)) do %>
              <div class="form-control">
                <%= master_beacon(@beacon).name %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <% if @beacon.persisted? && @beacon.triggers.any? %>
      <div id="beacon-applications" class="with-huge-space control-group">
        <div class="controls">
          <div class="form-group">
            <label class="control-label">
              <%= t('beacons.form.connected_applications') %>
            </label>
            <%- @beacon.triggers.each do |trigger| %>
              <% if trigger.application %>
                <%= link_to application_activities_path(trigger.application) do %>
                  <div class="form-control">
                    <div class="col-xs-1">
                      <span class="small-app-icon"></span>
                    </div>
                    <div class="col-xs-7">
                      <%= trigger.application.name %>
                    </div>
                    <div class="col-xs-4">
                      <% if trigger.application.activities.count == 0 %>
                        <%= t('beacons.form.no_actions') %>
                      <% else %>
                        <%= trigger.application.activities.count %>
                        <%= t('beacons.form.action').downcase.pluralize(trigger.application.activities.count) %>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            <%- end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="col-md-6 second-column">
    <%= render 'beacons/form/map',
               f: f,
               zones: zones
    %>
  </div>
</div>